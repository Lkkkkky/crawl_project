# https://aq.99.com/V3/NDUser_Login.htm
import json
import time
import base64
from idlelib.iomenu import encoding
from io import BytesIO
from PIL import Image
import ddddocr
import requests
import re
import random
import execjs
import cv2
import numpy as np

# 获取滑块图片相关信息
headers = {
    "accept": "application/json, text/javascript, */*; q=0.01",
    "accept-language": "zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6",
    "cache-control": "no-cache",
    "content-type": "application/x-www-form-urlencoded",
    "origin": "https://aq.99.com",
    "pragma": "no-cache",
    "priority": "u=1, i",
    "referer": "https://aq.99.com/",
    "sec-ch-ua": "\"Chromium\";v=\"130\", \"Microsoft Edge\";v=\"130\", \"Not?A_Brand\";v=\"99\"",
    "sec-ch-ua-mobile": "?0",
    "sec-ch-ua-platform": "\"Windows\"",
    "sec-fetch-dest": "empty",
    "sec-fetch-mode": "cors",
    "sec-fetch-site": "same-site",
    "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36 Edg/130.0.0.0"
}


def get_challenge():
    cookies = {
        "ASP.NET_SessionId": "wwycu255h4c5ue45cidmty45"
    }
    url = "https://aq.99.com/V5/Handler/Default.ashx"
    data = {
        "Action": "checkcodeinit",
        "Data": "ff4b9a84d4e9ed8dbe3b308dbaddb770",
        "Business": "common"
    }
    response = requests.post(url, headers=headers, cookies=cookies, data=data)
    res_json = json.loads(response.text)
    cha = res_json['Message']
    return cha


def get_image_info(cha):
    url = "https://checkcode.99.com/slide"
    data = {
        "action": "create",
        "challenge": cha,
        "ts": int(time.time() * 1000)
    }
    data = json.dumps(data, separators=(',', ':'))
    response = requests.post(url, headers=headers, data=data)
    res_json = json.loads(response.text)
    # print(response.text)
    bg_image = res_json['data']['originalImageBase64']
    slide_image = res_json['data']['sliderImageBase64']
    image_Random_Pos = res_json['data']['imageRandomPos']
    rsakey = res_json['data']['secretKey']
    return bg_image, slide_image, image_Random_Pos, rsakey


# base64 编码的图像数据（示例）
def save_image(bg_image, image_name):
    base64_data = bg_image
    # 将 base64 编码的字符串解码为二进制数据
    binary_data = base64.b64decode(base64_data)
    # 将二进制数据转换为 BytesIO 对象
    bytes_io = BytesIO(binary_data)
    # 使用 PIL（Pillow）加载图像
    image = Image.open(bytes_io)
    # 保存图像
    image.save(f"{image_name}.png")
    # print("图像保存成功")


# 底图还原
def fix_image(image_Random_Pos):
    i = 10
    o = image_Random_Pos
    a = 310
    s = 155
    im = Image.open('bg_image.png')
    new_img = Image.new("RGB", (a, s))
    h = 0
    l = 0
    p = 0
    d = 0
    v = 0
    g = len(o)
    for v in range(g):
        h = o[v]
        p = h * i
        if (h == g - 1):
            y = a - i * (g - 1)
        else:
            y = i
        l = im.crop(box=(d, 0, d + y, s))
        new_img.paste(l, box=(p, 0))
        d = d + y
        v = v + 1
    new_img.save("还原后.png")


# 识别滑块距离
def get_distance():
    slide = ddddocr.DdddOcr(show_ad=False)
    with open('bg_image.png', 'rb') as f:
        bg_byte = f.read()
    with open('slide_image.png', 'rb') as f:
        slide_byte = f.read()
    dis = slide.slide_match(slide_byte, bg_byte)
    # dis = slide.slide_comparison(target_byte, full_byte)
    print('滑动距离为：', dis['target'][0])

    return dis['target'][0]


def get_vertify(arr):
    url = "https://checkcode.99.com/slide"
    data = arr
    data = json.dumps(data, separators=(',', ':'))
    response = requests.post(url, headers=headers, data=data)
    # print(data)
    print(response.text)
    # print(response)


def make_trace(dis):
    init_list = [
        {
            "x": 0,
            "y": 0,
            "t": 1731830648488
        },
        {
            "x": 0,
            "y": -1,
            "t": 1731830648517
        },
        {
            "x": 1,
            "y": -1,
            "t": 1731830648518
        },
        {
            "x": 2,
            "y": -1,
            "t": 1731830648520
        },
        {
            "x": 3,
            "y": -1,
            "t": 1731830648522
        },
        {
            "x": 4,
            "y": -1,
            "t": 1731830648524
        },
        {
            "x": 4,
            "y": -2,
            "t": 1731830648525
        },
        {
            "x": 5,
            "y": -2,
            "t": 1731830648526
        },
        {
            "x": 6,
            "y": -2,
            "t": 1731830648527
        },
        {
            "x": 11,
            "y": -3,
            "t": 1731830648536
        },
        {
            "x": 11,
            "y": -4,
            "t": 1731830648537
        },
        {
            "x": 12,
            "y": -4,
            "t": 1731830648537
        },
        {
            "x": 13,
            "y": -4,
            "t": 1731830648538
        },
        {
            "x": 14,
            "y": -4,
            "t": 1731830648538
        },
        {
            "x": 15,
            "y": -5,
            "t": 1731830648539
        },
        {
            "x": 16,
            "y": -5,
            "t": 1731830648540
        },
        {
            "x": 17,
            "y": -5,
            "t": 1731830648541
        },
        {
            "x": 18,
            "y": -6,
            "t": 1731830648544
        },
        {
            "x": 19,
            "y": -6,
            "t": 1731830648545
        },
        {
            "x": 20,
            "y": -6,
            "t": 1731830648545
        },
        {
            "x": 21,
            "y": -7,
            "t": 1731830648546
        },
        {
            "x": 22,
            "y": -7,
            "t": 1731830648547
        },
        {
            "x": 24,
            "y": -7,
            "t": 1731830648548
        },
        {
            "x": 25,
            "y": -7,
            "t": 1731830648550
        },
        {
            "x": 26,
            "y": -7,
            "t": 1731830648552
        },
        {
            "x": 27,
            "y": -8,
            "t": 1731830648552
        },
        {
            "x": 29,
            "y": -8,
            "t": 1731830648553
        },
        {
            "x": 32,
            "y": -8,
            "t": 1731830648554
        },
        {
            "x": 35,
            "y": -9,
            "t": 1731830648557
        },
        {
            "x": 36,
            "y": -9,
            "t": 1731830648558
        },
        {
            "x": 37,
            "y": -9,
            "t": 1731830648558
        },
        {
            "x": 38,
            "y": -9,
            "t": 1731830648559
        },
        {
            "x": 40,
            "y": -9,
            "t": 1731830648560
        },
        {
            "x": 41,
            "y": -10,
            "t": 1731830648561
        },
        {
            "x": 43,
            "y": -10,
            "t": 1731830648562
        },
        {
            "x": 44,
            "y": -10,
            "t": 1731830648563
        },
        {
            "x": 45,
            "y": -10,
            "t": 1731830648564
        },
        {
            "x": 47,
            "y": -11,
            "t": 1731830648565
        },
        {
            "x": 48,
            "y": -11,
            "t": 1731830648566
        },
        {
            "x": 50,
            "y": -11,
            "t": 1731830648567
        },
        {
            "x": 51,
            "y": -11,
            "t": 1731830648568
        },
        {
            "x": 53,
            "y": -11,
            "t": 1731830648569
        },
        {
            "x": 54,
            "y": -11,
            "t": 1731830648571
        },
        {
            "x": 56,
            "y": -12,
            "t": 1731830648571
        },
        {
            "x": 57,
            "y": -12,
            "t": 1731830648572
        },
        {
            "x": 58,
            "y": -12,
            "t": 1731830648573
        },
        {
            "x": 60,
            "y": -12,
            "t": 1731830648574
        },
        {
            "x": 61,
            "y": -12,
            "t": 1731830648576
        },
        {
            "x": 62,
            "y": -12,
            "t": 1731830648576
        },
        {
            "x": 63,
            "y": -13,
            "t": 1731830648578
        },
        {
            "x": 64,
            "y": -13,
            "t": 1731830648578
        },
        {
            "x": 66,
            "y": -13,
            "t": 1731830648579
        },
        {
            "x": 67,
            "y": -13,
            "t": 1731830648580
        },
        {
            "x": 69,
            "y": -13,
            "t": 1731830648581
        },
        {
            "x": 70,
            "y": -13,
            "t": 1731830648582
        },
        {
            "x": 71,
            "y": -13,
            "t": 1731830648583
        },
        {
            "x": 73,
            "y": -13,
            "t": 1731830648585
        },
        {
            "x": 75,
            "y": -13,
            "t": 1731830648586
        },
        {
            "x": 76,
            "y": -13,
            "t": 1731830648587
        },
        {
            "x": 77,
            "y": -13,
            "t": 1731830648588
        },
        {
            "x": 78,
            "y": -13,
            "t": 1731830648590
        },
        {
            "x": 79,
            "y": -13,
            "t": 1731830648590
        },
        {
            "x": 80,
            "y": -14,
            "t": 1731830648592
        },
        {
            "x": 81,
            "y": -14,
            "t": 1731830648593
        },
        {
            "x": 82,
            "y": -14,
            "t": 1731830648593
        },
        {
            "x": 84,
            "y": -14,
            "t": 1731830648594
        },
        {
            "x": 86,
            "y": -14,
            "t": 1731830648596
        },
        {
            "x": 88,
            "y": -14,
            "t": 1731830648599
        },
        {
            "x": 89,
            "y": -14,
            "t": 1731830648601
        },
        {
            "x": 90,
            "y": -14,
            "t": 1731830648602
        },
        {
            "x": 91,
            "y": -14,
            "t": 1731830648602
        },
        {
            "x": 92,
            "y": -14,
            "t": 1731830648603
        },
        {
            "x": 93,
            "y": -14,
            "t": 1731830648606
        },
        {
            "x": 94,
            "y": -14,
            "t": 1731830648606
        },
        {
            "x": 95,
            "y": -14,
            "t": 1731830648608
        },
        {
            "x": 96,
            "y": -14,
            "t": 1731830648609
        },
        {
            "x": 97,
            "y": -14,
            "t": 1731830648610
        },
        {
            "x": 98,
            "y": -14,
            "t": 1731830648611
        },
        {
            "x": 99,
            "y": -14,
            "t": 1731830648612
        },
        {
            "x": 100,
            "y": -14,
            "t": 1731830648613
        },
        {
            "x": 101,
            "y": -14,
            "t": 1731830648613
        },
        {
            "x": 102,
            "y": -14,
            "t": 1731830648615
        },
        {
            "x": 103,
            "y": -14,
            "t": 1731830648616
        },
        {
            "x": 104,
            "y": -14,
            "t": 1731830648617
        },
        {
            "x": 105,
            "y": -14,
            "t": 1731830648618
        },
        {
            "x": 107,
            "y": -14,
            "t": 1731830648621
        },
        {
            "x": 108,
            "y": -14,
            "t": 1731830648623
        },
        {
            "x": 109,
            "y": -14,
            "t": 1731830648626
        },
        {
            "x": 110,
            "y": -14,
            "t": 1731830648627
        },
        {
            "x": 111,
            "y": -14,
            "t": 1731830648628
        },
        {
            "x": 112,
            "y": -14,
            "t": 1731830648630
        },
        {
            "x": 113,
            "y": -14,
            "t": 1731830648631
        },
        {
            "x": 115,
            "y": -13,
            "t": 1731830648634
        },
        {
            "x": 116,
            "y": -13,
            "t": 1731830648636
        },
        {
            "x": 117,
            "y": -13,
            "t": 1731830648638
        },
        {
            "x": 118,
            "y": -13,
            "t": 1731830648640
        },
        {
            "x": 119,
            "y": -13,
            "t": 1731830648641
        },
        {
            "x": 120,
            "y": -13,
            "t": 1731830648644
        },
        {
            "x": 121,
            "y": -12,
            "t": 1731830648645
        },
        {
            "x": 122,
            "y": -12,
            "t": 1731830648647
        },
        {
            "x": 123,
            "y": -12,
            "t": 1731830648649
        },
        {
            "x": 124,
            "y": -12,
            "t": 1731830648651
        },
        {
            "x": 125,
            "y": -12,
            "t": 1731830648654
        },
        {
            "x": 126,
            "y": -12,
            "t": 1731830648658
        },
        {
            "x": 127,
            "y": -12,
            "t": 1731830648661
        },
        {
            "x": 128,
            "y": -12,
            "t": 1731830648668
        },
        {
            "x": 129,
            "y": -12,
            "t": 1731830648738
        },
        {
            "x": 130,
            "y": -12,
            "t": 1731830648849
        },
        {
            "x": 131,
            "y": -12,
            "t": 1731830648856
        },
        {
            "x": 132,
            "y": -12,
            "t": 1731830648860
        },
        {
            "x": 133,
            "y": -12,
            "t": 1731830648864
        },
        {
            "x": 134,
            "y": -12,
            "t": 1731830648866
        },
        {
            "x": 135,
            "y": -12,
            "t": 1731830648871
        },
        {
            "x": 136,
            "y": -12,
            "t": 1731830648875
        },
        {
            "x": 137,
            "y": -12,
            "t": 1731830648877
        },
        {
            "x": 138,
            "y": -12,
            "t": 1731830648879
        },
        {
            "x": 139,
            "y": -12,
            "t": 1731830648881
        },
        {
            "x": 140,
            "y": -12,
            "t": 1731830648886
        },
        {
            "x": 141,
            "y": -12,
            "t": 1731830648887
        },
        {
            "x": 142,
            "y": -12,
            "t": 1731830648890
        },
        {
            "x": 143,
            "y": -12,
            "t": 1731830648892
        },
        {
            "x": 144,
            "y": -12,
            "t": 1731830648895
        },
        {
            "x": 145,
            "y": -12,
            "t": 1731830648896
        },
        {
            "x": 146,
            "y": -12,
            "t": 1731830648898
        },
        {
            "x": 147,
            "y": -12,
            "t": 1731830648900
        },
        {
            "x": 148,
            "y": -12,
            "t": 1731830648902
        },
        {
            "x": 149,
            "y": -12,
            "t": 1731830648903
        },
        {
            "x": 150,
            "y": -12,
            "t": 1731830648905
        },
        {
            "x": 151,
            "y": -12,
            "t": 1731830648906
        },
        {
            "x": 152,
            "y": -12,
            "t": 1731830648908
        },
        {
            "x": 153,
            "y": -12,
            "t": 1731830648909
        },
        {
            "x": 154,
            "y": -12,
            "t": 1731830648910
        },
        {
            "x": 155,
            "y": -12,
            "t": 1731830648913
        },
        {
            "x": 156,
            "y": -12,
            "t": 1731830648914
        },
        {
            "x": 157,
            "y": -12,
            "t": 1731830648914
        },
        {
            "x": 158,
            "y": -12,
            "t": 1731830648916
        },
        {
            "x": 159,
            "y": -12,
            "t": 1731830648918
        },
        {
            "x": 160,
            "y": -12,
            "t": 1731830648920
        },
        {
            "x": 161,
            "y": -12,
            "t": 1731830648921
        },
        {
            "x": 162,
            "y": -12,
            "t": 1731830648923
        },
        {
            "x": 163,
            "y": -12,
            "t": 1731830648925
        },
        {
            "x": 164,
            "y": -12,
            "t": 1731830648928
        },
        {
            "x": 165,
            "y": -12,
            "t": 1731830648931
        },
        {
            "x": 166,
            "y": -12,
            "t": 1731830648984
        },
        {
            "x": 167,
            "y": -12,
            "t": 1731830648994
        },
        {
            "x": 168,
            "y": -12,
            "t": 1731830648999
        },
        {
            "x": 169,
            "y": -12,
            "t": 1731830649006
        },
        {
            "x": dis - 1,
            "y": -12,
            "t": 1731830649011
        },
        {
            "x": dis,
            "y": -12,
            "t": 1731830649016
        },
        {
            "x": dis - 6,
            "y": -12,
            "t": 1731830649136
        }
    ]
    return init_list


# 获取滑块距离
def identify_gap(bg_image, slide_image):
    """
    bg: 背景图片
    tp: 缺口图片
    out: 输出图片
    """
    # 读取背景图片和缺口图片
    with open('还原后.png', 'rb') as f:  # 以二进制模式打开文件
        bg_byte_data = f.read()
    with open('slide_image.png', 'rb') as f:  # 以二进制模式打开文件
        slide_byte_data = f.read()
    bg_img = cv2.imdecode(np.frombuffer(bg_byte_data, np.uint8), cv2.IMREAD_GRAYSCALE)
    tp_img = cv2.imdecode(np.frombuffer(slide_byte_data, np.uint8), cv2.IMREAD_GRAYSCALE)  # 缺口图片
    yy = []
    xx = []
    for y in range(tp_img.shape[0]):
        for x in range(tp_img.shape[1]):
            r = tp_img[y, x]
            if r < 200:
                yy.append(y)
                xx.append(x)
    tp_img = tp_img[min(yy):max(yy), min(xx):max(xx)]
    # 识别图片边缘
    bg_edge = cv2.Canny(bg_img, 100, 200)
    tp_edge = cv2.Canny(tp_img, 100, 200)
    # 转换图片格式
    bg_pic = cv2.cvtColor(bg_edge, cv2.COLOR_GRAY2RGB)
    tp_pic = cv2.cvtColor(tp_edge, cv2.COLOR_GRAY2RGB)
    # 缺口匹配
    res = cv2.matchTemplate(bg_pic, tp_pic, cv2.TM_CCOEFF_NORMED)
    min_val, max_val, min_loc, max_loc = cv2.minMaxLoc(res)  # 寻找最优匹配
    # # 绘制方框
    th, tw = tp_pic.shape[:2]
    tl = max_loc  # 左上角点的坐标
    br = (tl[0] + tw, tl[1] + th)  # 右下角点的坐标
    cv2.rectangle(bg_img, tl, br, (0, 0, 255), 2)  # 绘制矩形
    cv2.imwrite('distinguish.png', bg_img)  # 保存在本地
    # 返回缺口的X坐标
    # print(max_loc[0])
    return max_loc[0]


# 获取滑块轨迹1
def guiji(distance):
    trackList = [{
        "x": 0,
        "y": 0,
        "t": 1731951607030
    },
        {
            "x": 0,
            "y": 0,
            "t": 1731951607035
        },
        {
            "x": 1,
            "y": 0,
            "t": 1731951607099
        },
        {
            "x": 2,
            "y": 0,
            "t": 1731951607105
        },
        {
            "x": 3,
            "y": 0,
            "t": 1731951607110
        },
        {
            "x": 4,
            "y": 0,
            "t": 1731951607117
        },
        {
            "x": 5,
            "y": 0,
            "t": 1731951607123
        },
        {
            "x": 6,
            "y": 0,
            "t": 1731951607134
        },
        {
            "x": 7,
            "y": 0,
            "t": 1731951607140
        },
        {
            "x": 8,
            "y": 0,
            "t": 1731951607145
        },
        {
            "x": 9,
            "y": 0,
            "t": 1731951607149
        },
        {
            "x": 10,
            "y": 0,
            "t": 1731951607157
        },
        {
            "x": 10,
            "y": 1,
            "t": 1731951607157
        },
        {
            "x": 11,
            "y": 1,
            "t": 1731951607162
        },
        {
            "x": 12,
            "y": 1,
            "t": 1731951607168
        },
        {
            "x": 13,
            "y": 1,
            "t": 1731951607174
        },
        {
            "x": 14,
            "y": 1,
            "t": 1731951607180
        },
        {
            "x": 15,
            "y": 1,
            "t": 1731951607183
        },
        {
            "x": 16,
            "y": 1,
            "t": 1731951607190
        },
        {
            "x": 17,
            "y": 1,
            "t": 1731951607195
        },
        {
            "x": 18,
            "y": 1,
            "t": 1731951607198
        },
        {
            "x": 18,
            "y": 2,
            "t": 1731951607198
        },
        {
            "x": 19,
            "y": 2,
            "t": 1731951607202
        },
        {
            "x": 20,
            "y": 2,
            "t": 1731951607205
        },
        {
            "x": 21,
            "y": 2,
            "t": 1731951607210
        },
        {
            "x": 22,
            "y": 2,
            "t": 1731951607213
        },
        {
            "x": 23,
            "y": 2,
            "t": 1731951607217
        },
        {
            "x": 24,
            "y": 2,
            "t": 1731951607221
        },
        {
            "x": 25,
            "y": 2,
            "t": 1731951607225
        },
        {
            "x": 26,
            "y": 2,
            "t": 1731951607229
        },
        {
            "x": 27,
            "y": 2,
            "t": 1731951607233
        },
        {
            "x": 28,
            "y": 2,
            "t": 1731951607237
        },
        {
            "x": 29,
            "y": 2,
            "t": 1731951607242
        },
        {
            "x": 30,
            "y": 2,
            "t": 1731951607246
        },
        {
            "x": 31,
            "y": 2,
            "t": 1731951607252
        },
        {
            "x": 32,
            "y": 2,
            "t": 1731951607257
        },
        {
            "x": 33,
            "y": 2,
            "t": 1731951607264
        },
        {
            "x": 34,
            "y": 2,
            "t": 1731951607273
        },
        {
            "x": 35,
            "y": 2,
            "t": 1731951607292
        },
        {
            "x": 36,
            "y": 2,
            "t": 1731951607301
        },
        {
            "x": 37,
            "y": 2,
            "t": 1731951607309
        },
        {
            "x": 38,
            "y": 2,
            "t": 1731951607315
        },
        {
            "x": 39,
            "y": 2,
            "t": 1731951607322
        },
        {
            "x": 40,
            "y": 2,
            "t": 1731951607327
        },
        {
            "x": 41,
            "y": 2,
            "t": 1731951607331
        },
        {
            "x": 42,
            "y": 2,
            "t": 1731951607335
        },
        {
            "x": 43,
            "y": 2,
            "t": 1731951607341
        },
        {
            "x": 44,
            "y": 2,
            "t": 1731951607344
        },
        {
            "x": 44,
            "y": 3,
            "t": 1731951607345
        },
        {
            "x": 45,
            "y": 3,
            "t": 1731951607347
        },
        {
            "x": 46,
            "y": 3,
            "t": 1731951607350
        },
        {
            "x": 47,
            "y": 3,
            "t": 1731951607354
        },
        {
            "x": 48,
            "y": 3,
            "t": 1731951607357
        },
        {
            "x": 49,
            "y": 3,
            "t": 1731951607361
        },
        {
            "x": 50,
            "y": 3,
            "t": 1731951607365
        },
        {
            "x": 51,
            "y": 3,
            "t": 1731951607366
        },
        {
            "x": 52,
            "y": 3,
            "t": 1731951607372
        },
        {
            "x": 53,
            "y": 3,
            "t": 1731951607375
        },
        {
            "x": 54,
            "y": 3,
            "t": 1731951607378
        },
        {
            "x": 55,
            "y": 3,
            "t": 1731951607381
        },
        {
            "x": 56,
            "y": 3,
            "t": 1731951607385
        },
        {
            "x": 57,
            "y": 3,
            "t": 1731951607388
        },
        {
            "x": 58,
            "y": 3,
            "t": 1731951607391
        },
        {
            "x": 59,
            "y": 3,
            "t": 1731951607394
        },
        {
            "x": 60,
            "y": 3,
            "t": 1731951607399
        },
        {
            "x": 61,
            "y": 3,
            "t": 1731951607399
        },
        {
            "x": 62,
            "y": 3,
            "t": 1731951607403
        },
        {
            "x": 63,
            "y": 3,
            "t": 1731951607406
        },
        {
            "x": 64,
            "y": 3,
            "t": 1731951607406
        },
        {
            "x": 64,
            "y": 4,
            "t": 1731951607408
        },
        {
            "x": 65,
            "y": 4,
            "t": 1731951607413
        },
        {
            "x": 66,
            "y": 4,
            "t": 1731951607416
        },
        {
            "x": 67,
            "y": 4,
            "t": 1731951607419
        },
        {
            "x": 68,
            "y": 4,
            "t": 1731951607423
        },
        {
            "x": 69,
            "y": 4,
            "t": 1731951607424
        },
        {
            "x": 70,
            "y": 4,
            "t": 1731951607429
        },
        {
            "x": 71,
            "y": 4,
            "t": 1731951607431
        },
        {
            "x": 72,
            "y": 4,
            "t": 1731951607434
        },
        {
            "x": 73,
            "y": 4,
            "t": 1731951607438
        },
        {
            "x": 74,
            "y": 4,
            "t": 1731951607442
        },
        {
            "x": 75,
            "y": 4,
            "t": 1731951607445
        },
        {
            "x": 76,
            "y": 4,
            "t": 1731951607449
        },
        {
            "x": 77,
            "y": 4,
            "t": 1731951607452
        },
        {
            "x": 78,
            "y": 4,
            "t": 1731951607457
        },
        {
            "x": 79,
            "y": 4,
            "t": 1731951607461
        },
        {
            "x": 80,
            "y": 4,
            "t": 1731951607465
        },
        {
            "x": 81,
            "y": 4,
            "t": 1731951607468
        },
        {
            "x": 82,
            "y": 4,
            "t": 1731951607474
        },
        {
            "x": 83,
            "y": 4,
            "t": 1731951607478
        },
        {
            "x": 84,
            "y": 4,
            "t": 1731951607482
        },
        {
            "x": 85,
            "y": 4,
            "t": 1731951607486
        },
        {
            "x": 86,
            "y": 4,
            "t": 1731951607490
        },
        {
            "x": 87,
            "y": 4,
            "t": 1731951607494
        },
        {
            "x": 88,
            "y": 4,
            "t": 1731951607498
        },
        {
            "x": 89,
            "y": 4,
            "t": 1731951607504
        },
        {
            "x": 90,
            "y": 4,
            "t": 1731951607508
        },
        {
            "x": 91,
            "y": 4,
            "t": 1731951607515
        },
        {
            "x": 92,
            "y": 4,
            "t": 1731951607520
        },
        {
            "x": 93,
            "y": 4,
            "t": 1731951607524
        },
        {
            "x": 94,
            "y": 4,
            "t": 1731951607535
        },
        {
            "x": 95,
            "y": 4,
            "t": 1731951607539
        },
        {
            "x": 96,
            "y": 4,
            "t": 1731951607542
        },
        {
            "x": 97,
            "y": 4,
            "t": 1731951607548
        },
        {
            "x": 98,
            "y": 4,
            "t": 1731951607551
        },
        {
            "x": 99,
            "y": 4,
            "t": 1731951607555
        },
        {
            "x": 100,
            "y": 4,
            "t": 1731951607558
        },
        {
            "x": 101,
            "y": 4,
            "t": 1731951607563
        },
        {
            "x": 102,
            "y": 4,
            "t": 1731951607567
        },
        {
            "x": 103,
            "y": 4,
            "t": 1731951607570
        },
        {
            "x": 104,
            "y": 4,
            "t": 1731951607573
        },
        {
            "x": 105,
            "y": 4,
            "t": 1731951607576
        },
        {
            "x": 106,
            "y": 4,
            "t": 1731951607578
        },
        {
            "x": 107,
            "y": 4,
            "t": 1731951607581
        },
        {
            "x": 108,
            "y": 4,
            "t": 1731951607585
        },
        {
            "x": 109,
            "y": 4,
            "t": 1731951607586
        },
        {
            "x": 110,
            "y": 4,
            "t": 1731951607590
        },
        {
            "x": 111,
            "y": 4,
            "t": 1731951607593
        },
        {
            "x": 112,
            "y": 4,
            "t": 1731951607594
        },
        {
            "x": 113,
            "y": 4,
            "t": 1731951607596
        },
        {
            "x": 114,
            "y": 4,
            "t": 1731951607599
        },
        {
            "x": 115,
            "y": 4,
            "t": 1731951607602
        },
        {
            "x": 116,
            "y": 4,
            "t": 1731951607605
        },
        {
            "x": 117,
            "y": 4,
            "t": 1731951607606
        },
        {
            "x": 118,
            "y": 4,
            "t": 1731951607610
        },
        {
            "x": 119,
            "y": 4,
            "t": 1731951607612
        },
        {
            "x": 120,
            "y": 4,
            "t": 1731951607614
        },
        {
            "x": 121,
            "y": 4,
            "t": 1731951607617
        },
        {
            "x": 122,
            "y": 4,
            "t": 1731951607619
        },
        {
            "x": 123,
            "y": 4,
            "t": 1731951607624
        },
        {
            "x": 124,
            "y": 4,
            "t": 1731951607626
        },
        {
            "x": 125,
            "y": 4,
            "t": 1731951607627
        },
        {
            "x": 126,
            "y": 4,
            "t": 1731951607629
        },
        {
            "x": 127,
            "y": 4,
            "t": 1731951607632
        },
        {
            "x": 128,
            "y": 4,
            "t": 1731951607635
        },
        {
            "x": 129,
            "y": 4,
            "t": 1731951607635
        },
        {
            "x": 130,
            "y": 4,
            "t": 1731951607639
        },
        {
            "x": 131,
            "y": 4,
            "t": 1731951607641
        },
        {
            "x": 132,
            "y": 4,
            "t": 1731951607643
        },
        {
            "x": 133,
            "y": 4,
            "t": 1731951607644
        },
        {
            "x": 134,
            "y": 4,
            "t": 1731951607647
        },
        {
            "x": 135,
            "y": 4,
            "t": 1731951607650
        },
        {
            "x": 136,
            "y": 4,
            "t": 1731951607652
        },
        {
            "x": 137,
            "y": 4,
            "t": 1731951607653
        },
        {
            "x": 138,
            "y": 4,
            "t": 1731951607656
        },
        {
            "x": 139,
            "y": 4,
            "t": 1731951607658
        },
        {
            "x": 140,
            "y": 4,
            "t": 1731951607660
        },
        {
            "x": 141,
            "y": 4,
            "t": 1731951607663
        },
        {
            "x": 142,
            "y": 4,
            "t": 1731951607666
        },
        {
            "x": 143,
            "y": 4,
            "t": 1731951607669
        },
        {
            "x": 144,
            "y": 4,
            "t": 1731951607672
        },
        {
            "x": 145,
            "y": 4,
            "t": 1731951607674
        },
        {
            "x": 146,
            "y": 4,
            "t": 1731951607677
        },
        {
            "x": 147,
            "y": 4,
            "t": 1731951607680
        },
        {
            "x": 148,
            "y": 4,
            "t": 1731951607681
        },
        {
            "x": 149,
            "y": 4,
            "t": 1731951607684
        },
        {
            "x": 150,
            "y": 4,
            "t": 1731951607687
        },
        {
            "x": 151,
            "y": 4,
            "t": 1731951607688
        },
        {
            "x": 152,
            "y": 4,
            "t": 1731951607692
        },
        {
            "x": 153,
            "y": 4,
            "t": 1731951607699
        },
        {
            "x": 154,
            "y": 4,
            "t": 1731951607702
        },
        {
            "x": 155,
            "y": 4,
            "t": 1731951607704
        },
        {
            "x": 156,
            "y": 4,
            "t": 1731951607707
        },
        {
            "x": 157,
            "y": 4,
            "t": 1731951607709
        },
        {
            "x": 157,
            "y": 3,
            "t": 1731951607712
        },
        {
            "x": 158,
            "y": 3,
            "t": 1731951607713
        },
        {
            "x": 159,
            "y": 3,
            "t": 1731951607718
        },
        {
            "x": 160,
            "y": 3,
            "t": 1731951607721
        },
        {
            "x": 161,
            "y": 3,
            "t": 1731951607724
        },
        {
            "x": 162,
            "y": 3,
            "t": 1731951607729
        },
        {
            "x": 163,
            "y": 3,
            "t": 1731951607733
        },
        {
            "x": 164,
            "y": 3,
            "t": 1731951607737
        },
        {
            "x": 165,
            "y": 3,
            "t": 1731951607740
        },
        {
            "x": 166,
            "y": 3,
            "t": 1731951607744
        },
        {
            "x": 167,
            "y": 3,
            "t": 1731951607748
        },
        {
            "x": 168,
            "y": 3,
            "t": 1731951607752
        },
        {
            "x": 169,
            "y": 3,
            "t": 1731951607756
        },
        {
            "x": 170,
            "y": 3,
            "t": 1731951607758
        },
        {
            "x": 171,
            "y": 3,
            "t": 1731951607763
        },
        {
            "x": 172,
            "y": 3,
            "t": 1731951607765
        },
        {
            "x": 173,
            "y": 3,
            "t": 1731951607770
        },
        {
            "x": 174,
            "y": 3,
            "t": 1731951607774
        },
        {
            "x": 175,
            "y": 3,
            "t": 1731951607777
        },
        {
            "x": 176,
            "y": 3,
            "t": 1731951607781
        },
        {
            "x": 177,
            "y": 3,
            "t": 1731951607784
        },
        {
            "x": 178,
            "y": 3,
            "t": 1731951607788
        },
        {
            "x": 179,
            "y": 3,
            "t": 1731951607792
        },
        {
            "x": 180,
            "y": 3,
            "t": 1731951607793
        },
        {
            "x": 181,
            "y": 3,
            "t": 1731951607795
        },
        {
            "x": 182,
            "y": 3,
            "t": 1731951607800
        },
        {
            "x": 183,
            "y": 3,
            "t": 1731951607803
        },
        {
            "x": 184,
            "y": 3,
            "t": 1731951607806
        },
        {
            "x": 184,
            "y": 4,
            "t": 1731951607807
        },
        {
            "x": 185,
            "y": 4,
            "t": 1731951607807
        },
        {
            "x": 186,
            "y": 4,
            "t": 1731951607810
        },
        {
            "x": 187,
            "y": 4,
            "t": 1731951607813
        },
        {
            "x": 188,
            "y": 4,
            "t": 1731951607814
        },
        {
            "x": 189,
            "y": 4,
            "t": 1731951607815
        },
        {
            "x": 190,
            "y": 4,
            "t": 1731951607819
        },
        {
            "x": 191,
            "y": 4,
            "t": 1731951607820
        },
        {
            "x": 192,
            "y": 4,
            "t": 1731951607822
        },
        {
            "x": 193,
            "y": 4,
            "t": 1731951607824
        },
        {
            "x": 194,
            "y": 4,
            "t": 1731951607827
        },
        {
            "x": 195,
            "y": 4,
            "t": 1731951607829
        },
        {
            "x": 196,
            "y": 4,
            "t": 1731951607831
        },
        {
            "x": 197,
            "y": 4,
            "t": 1731951607834
        },
        {
            "x": 198,
            "y": 4,
            "t": 1731951607837
        },
        {
            "x": 199,
            "y": 4,
            "t": 1731951607840
        },
        {
            "x": 200,
            "y": 4,
            "t": 1731951607842
        },
        {
            "x": 201,
            "y": 4,
            "t": 1731951607844
        },
        {
            "x": 202,
            "y": 4,
            "t": 1731951607848
        },
        {
            "x": 203,
            "y": 4,
            "t": 1731951607850
        },
        {
            "x": 204,
            "y": 4,
            "t": 1731951607852
        },
        {
            "x": 205,
            "y": 4,
            "t": 1731951607855
        },
        {
            "x": 206,
            "y": 4,
            "t": 1731951607860
        },
        {
            "x": 207,
            "y": 4,
            "t": 1731951607862
        },
        {
            "x": 208,
            "y": 4,
            "t": 1731951607866
        },
        {
            "x": 209,
            "y": 4,
            "t": 1731951607869
        },
        {
            "x": 210,
            "y": 4,
            "t": 1731951607873
        },
        {
            "x": 211,
            "y": 5,
            "t": 1731951607876
        },
        {
            "x": 212,
            "y": 5,
            "t": 1731951607884
        },
        {
            "x": 213,
            "y": 5,
            "t": 1731951607889
        },
        {
            "x": 214,
            "y": 5,
            "t": 1731951607892
        },
        {
            "x": 215,
            "y": 5,
            "t": 1731951607897
        },
        {
            "x": 216,
            "y": 5,
            "t": 1731951607900
        },
        {
            "x": 217,
            "y": 5,
            "t": 1731951607906
        },
        {
            "x": 218,
            "y": 6,
            "t": 1731951607909
        },
        {
            "x": 219,
            "y": 6,
            "t": 1731951607912
        },
        {
            "x": 220,
            "y": 6,
            "t": 1731951607916
        },
        {
            "x": 221,
            "y": 6,
            "t": 1731951607918
        },
        {
            "x": 222,
            "y": 6,
            "t": 1731951607924
        },
        {
            "x": 223,
            "y": 6,
            "t": 1731951607928
        },
        {
            "x": 224,
            "y": 6,
            "t": 1731951607933
        },
        {
            "x": 225,
            "y": 6,
            "t": 1731951607936
        },
        {
            "x": 226,
            "y": 6,
            "t": 1731951607942
        },
        {
            "x": 227,
            "y": 6,
            "t": 1731951607947
        },
        {
            "x": 228,
            "y": 6,
            "t": 1731951607952
        },
        {
            "x": 229,
            "y": 6,
            "t": 1731951607956
        },
        {
            "x": 230,
            "y": 6,
            "t": 1731951607963
        },
        {
            "x": 231,
            "y": 6,
            "t": 1731951607967
        },
        {
            "x": 232,
            "y": 6,
            "t": 1731951607971
        },
        {
            "x": 233,
            "y": 6,
            "t": 1731951607976
        },
        {
            "x": 234,
            "y": 6,
            "t": 1731951607981
        },
        {
            "x": 235,
            "y": 6,
            "t": 1731951607985
        },
        {
            "x": 236,
            "y": 6,
            "t": 1731951607989
        },
        {
            "x": 237,
            "y": 6,
            "t": 1731951607994
        },
        {
            "x": 238,
            "y": 6,
            "t": 1731951607997
        },
        {
            "x": 239,
            "y": 6,
            "t": 1731951608000
        },
        {
            "x": 240,
            "y": 6,
            "t": 1731951608006
        },
        {
            "x": 241,
            "y": 6,
            "t": 1731951608014
        },
        {
            "x": 242,
            "y": 6,
            "t": 1731951608019
        },
        {
            "x": 243,
            "y": 6,
            "t": 1731951608024
        },
        {
            "x": 244,
            "y": 6,
            "t": 1731951608030
        },
        {
            "x": 245,
            "y": 6,
            "t": 1731951608039
        },
        {
            "x": 246,
            "y": 6,
            "t": 1731951608047
        },
        {
            "x": 247,
            "y": 6,
            "t": 1731951608060
        },
        {
            "x": 248,
            "y": 6,
            "t": 1731951608077
        },
        {
            "x": 249,
            "y": 6,
            "t": 1731951608090
        },
        {
            "x": 250,
            "y": 6,
            "t": 1731951608098
        },
        {
            "x": 251,
            "y": 6,
            "t": 1731951608105
        },
        {
            "x": 252,
            "y": 6,
            "t": 1731951608110
        },
        {
            "x": 253,
            "y": 6,
            "t": 1731951608112
        },
        {
            "x": 254,
            "y": 6,
            "t": 1731951608117
        },
        {
            "x": 255,
            "y": 6,
            "t": 1731951608121
        },
        {
            "x": 255,
            "y": 7,
            "t": 1731951608124
        },
        {
            "x": 256,
            "y": 7,
            "t": 1731951608125
        },
        {
            "x": 257,
            "y": 7,
            "t": 1731951608131
        },
        {
            "x": 258,
            "y": 7,
            "t": 1731951608137
        },
        {
            "x": 259,
            "y": 7,
            "t": 1731951608144
        },
        {
            "x": 260,
            "y": 7,
            "t": 1731951608154
        },
        {
            "x": 261,
            "y": 7,
            "t": 1731951608160
        },
        {
            "x": 262,
            "y": 7,
            "t": 1731951608170
        },
        {
            "x": 263,
            "y": 7,
            "t": 1731951608176
        },
        {
            "x": 264,
            "y": 7,
            "t": 1731951608186
        },
        {
            "x": 265,
            "y": 7,
            "t": 1731951608196
        },
        {
            "x": 265,
            "y": 8,
            "t": 1731951608205
        },
        {
            "x": 266,
            "y": 8,
            "t": 1731951608206
        },
        {
            "x": 267,
            "y": 8,
            "t": 1731951608215
        },
        {
            "x": 268,
            "y": 8,
            "t": 1731951608223
        },
        {
            "x": 269,
            "y": 8,
            "t": 1731951608236
        },
        {
            "x": 270,
            "y": 8,
            "t": 1731951608257
        },
        {
            "x": 271,
            "y": 8,
            "t": 1731951608267
        },
        {
            "x": 272,
            "y": 8,
            "t": 1731951608275
        },
        {
            "x": 273,
            "y": 8,
            "t": 1731951608278
        },
        {
            "x": 274,
            "y": 8,
            "t": 1731951608286
        },
        {
            "x": 275,
            "y": 8,
            "t": 1731951608297
        },
        {
            "x": 276,
            "y": 8,
            "t": 1731951608305
        },
        {
            "x": 277,
            "y": 8,
            "t": 1731951608337
        },
        {
            "x": 278,
            "y": 8,
            "t": 1731951608367
        },
        {
            "x": 279,
            "y": 8,
            "t": 1731951608376
        },
        {
            "x": 280,
            "y": 8,
            "t": 1731951608398
        },
        {
            "x": 281,
            "y": 8,
            "t": 1731951608404
        },
        {
            "x": 275,
            "y": 8,
            "t": 1731951608614
        }]


    for trajectory in trackList:
        if trajectory['x'] == distance:
            # 如果找到，截取从轨迹开始到该点的子数组
            return [t for t in trackList if t['x'] <= distance]

        # 如果value不在x值中，找到最接近value的x值
    closest_x = None
    min_diff = float('inf')
    for trajectory in trackList:
        if abs(trajectory['x'] - distance) < min_diff:
            min_diff = abs(trajectory['x'] - distance)
            closest_x = trajectory['x']

    # 截取从轨迹开始到最接近的x值的子数组
    result = [t for t in trackList if t['x'] <= closest_x]
    result[-1]['x'] = distance
    return result

for i in range(20):
    cha = get_challenge()
    bg_image, slide_image, image_Random_Pos, rsakey = get_image_info(cha)
    # print(rsakey)
    # print(slide_image)
    # print('cha---->'+cha)

    save_image(bg_image, 'bg_image')
    save_image(slide_image, 'slide_image')
    fix_image(image_Random_Pos)
    # dis=get_distance()
    dis = identify_gap(bg_image, slide_image)
    # dis = get_distance()
    # init_list = make_trace(dis)
    init_list = guiji(dis)
    # print(init_list)
    arr = execjs.compile(open('轨迹加密.js', 'r', encoding='utf-8').read()).call('get_enc', rsakey, init_list,
                                                                                 slide_image,
                                                                                 cha)
    get_vertify(arr)
